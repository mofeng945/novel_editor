# 小说编辑器 V2.0
一个为小说作者设计的简易离线编辑工具，帮助作者轻松创作、编辑和管理多本小说作品，支持离线使用和个性化界面设置。

## V2.0 更新内容

### ✨ 功能增强
- 图片插入功能全面优化，支持默认插入到章节末尾
- 图片编辑模态框体验改进，背景显示更加清晰
- 图片选择对话框优化，防止重复点击导致的多次弹窗问题

### 🐛 问题修复
- 修复图片编辑模态框背景显示问题
- 解决图片选择后弹窗出现两次的问题
- 修复模态框底部按钮溢出问题

### 🎨 UI/UX 优化
- 优化模态框布局和交互体验
- 增强图片编辑功能的可用性

## 功能特性

### 📝 文本编辑功能
- 富文本编辑，支持多种格式（粗体、斜体、下划线等）
- 章节标题设置（标题1、标题2）
- 列表功能（有序列表、无序列表）
- 引用样式支持
- 特殊符号插入（引号、破折号等）

### 💾 保存功能
- 自动定时保存（每30秒自动保存一次）
- 手动保存按钮
- 本地存储，刷新页面后内容不丢失
- 保存状态实时显示

### 🖼️ 媒体支持
- 图片插入功能

### 📤 导出功能
- 导出为文本文档(.txt)

### 💾 数据备份与恢复
- **数据备份与恢复**: 提供完整的数据备份功能，可以一键备份所有书籍和设置，并在需要时快速恢复。
- **自动备份**: 支持设置定期自动备份，可选择每天、每周或每月备份频率，确保数据安全。
- **备份快捷键**: 使用 Ctrl+B (Windows) 或 Cmd+B (Mac) 快速打开备份面板。

### 📚 书架功能
- 支持管理多本小说作品
- 作品卡片展示，包含标题、简介和修改时间
- 创建新作品、编辑作品信息、删除作品功能
- 书架布局切换（网格视图/列表视图）

### ⌨️ 快捷键支持
- Ctrl+S: 快速保存
- Ctrl+E: 导出Word文档

### 🎨 UI个性化设置
- 多种主题颜色选择（蓝色、绿色、橙色、紫色、红色）
- 自定义主题颜色设置
- 背景样式自定义（纯色/图片）
- 布局偏好设置（默认网格视图）

### 🌐 离线支持
- 完全离线可用，无需网络连接
- 支持添加到设备主屏幕，获得接近原生应用的体验
- 所有数据自动保存到本地存储

## 如何使用

### 作品管理
1. 打开应用程序（通过浏览器访问 `http://localhost:8000` 或直接双击 `index.html` 文件）
2. 在书架界面，点击"创建新作品"按钮，输入作品标题和简介
3. 点击任意作品卡片进入该作品的编辑界面
4. 在编辑界面点击"返回书架"按钮可回到作品列表
5. 在书架界面，点击作品卡片上的"编辑"按钮可修改作品信息
6. 在书架界面，点击作品卡片上的"删除"按钮可移除作品

### UI个性化设置
1. 在书架界面或编辑界面，点击右上角的"设置"按钮
2. 在设置模态框中：
   - 从预设主题中选择喜欢的颜色（蓝色、绿色、橙色、紫色、红色）
   - 或使用自定义颜色输入框设置主色调和悬停色
   - 选择背景样式（纯色或图片）
   - 如果选择图片背景，可以上传自己的图片作为背景
   - 选择书架的默认布局（网格视图或列表视图）
3. 设置完成后，点击"保存"按钮，所有设置将立即应用并保存

### 本地使用指南
1. 直接双击index.html文件即可在本地运行应用
2. 所有功能无需网络连接，完全离线可用
3. 数据自动保存到浏览器的localStorage中
4. 建议定期导出重要作品作为备份，以防浏览器缓存清理或设备重置导致数据丢失

### 内容编辑
1. 进入作品编辑界面后，在编辑区域开始编写你的小说
2. 使用顶部工具栏进行格式设置
3. 使用特殊符号按钮插入常用的文学符号
4. 点击"插入图片"按钮上传并插入图片
5. 完成后点击"导出Word"按钮将当前作品导出为Word文档

## 技术说明

- 基于HTML、CSS和JavaScript构建的单页应用
- 使用Quill.js作为富文本编辑器核心
- 使用FileSaver.js实现文件导出功能
- 使用docx.js实现Word文档生成
- 采用Service Worker技术实现离线缓存和PWA功能
- 使用localStorage进行数据持久化存储
- 所有数据存储在用户本地浏览器中，不会上传到任何服务器
- 支持响应式设计，可在不同设备上使用

### 核心技术特性
- **持久化存储**：采用IndexedDB作为主要存储方式，提供更好的数据持久性
- **多层级存储策略**：IndexedDB优先，localStorage作为后备方案
- **数据迁移**：自动从旧存储方式迁移到新存储方式
- **全面错误处理**：提供友好的错误提示和降级机制
- **主题系统**：基于CSS变量实现的灵活主题系统

### 持久化存储工作原理

应用采用了多层级的存储策略，以确保您的小说内容最大限度地避免因清除浏览数据而丢失：

- **主要存储**: 使用IndexedDB数据库，提供更大的存储空间和更好的数据持久性
- **后备存储**: 当IndexedDB不可用时，自动降级到localStorage
- **数据迁移**: 自动从localStorage迁移现有数据到IndexedDB
- **安全机制**: 实现了异步存储操作和全面的错误处理
- **无需网络**: 所有数据完全存储在本地，不需要网络连接
- **跨会话保留**: 即使重启浏览器，数据也会自动恢复

**重要提示**: 虽然IndexedDB提供了更好的数据持久性，但在执行"清除所有浏览数据"操作时，如果用户明确选择删除站点数据，仍然可能导致数据丢失。建议定期备份重要内容。

## 注意事项

- 请定期手动保存你的作品，以防意外情况发生
- 刷新页面前请确保内容已保存
- 浏览器清除缓存或localStorage可能会导致已保存的内容丢失
- 图片导出功能可能受到浏览器安全限制的影响
- 不同浏览器之间的数据不共享，如需在多个浏览器中使用，请手动导出并导入数据
- 离线功能依赖于Service Worker和浏览器缓存，请确保浏览器支持这些特性
- 首次使用离线功能需要有网络连接，以便浏览器缓存必要的资源

### 数据安全提示
- 虽然应用支持离线使用，但建议定期导出重要作品作为备份
- 浏览器更新、设备重置或清理缓存可能导致数据丢失
- 对于重要作品，建议使用导出功能创建额外的备份副本

### 跨设备使用说明
- 由于数据存储在本地浏览器中，直接跨设备访问数据有限制
- 如需在多设备间使用，可以通过以下方式：
  1. 在原设备导出作品为Word文档
  2. 在目标设备导入或重新创建作品
  3. 定期同步重要内容

## 开发环境搭建

如果需要修改或扩展这个应用：

1. 克隆或下载本项目
2. 使用任何现代浏览器打开 `index.html` 文件即可运行
3. 如需启动本地服务器进行开发测试，可使用Python的内置HTTP服务器：
   ```
   python -m http.server 8000 --directory ./
   ```
4. 访问 `http://localhost:8000` 查看应用

### 开发注意事项

- 如需修改PWA配置，请编辑 `manifest.json` 文件
- 所有依赖库文件都位于 `libs` 目录中
- 存储操作现在是异步的，请确保在适当的时机处理Promise
- 已实现IndexedDB和localStorage的自动降级机制
- 数据迁移逻辑在首次加载时自动执行
- 存储错误会在控制台记录并显示用户友好的提示
- 建议在开发时定期测试不同浏览器的存储兼容性
- 备份功能使用.novelbackup扩展名，包含所有书籍数据和设置
- 自动备份系统支持可配置的备份频率和自动清理旧备份

### 测试持久化存储功能

1. 直接打开index.html文件
2. 创建一本新小说并添加一些内容
3. 保存小说并关闭浏览器
4. 重新打开浏览器并加载index.html
5. 验证您的小说内容是否正确加载
6. 可选测试：在不选择"删除站点数据"的情况下清除浏览历史，检查数据是否保留

## License

MIT License
